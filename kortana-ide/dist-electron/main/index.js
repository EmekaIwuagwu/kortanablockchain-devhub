"use strict";const e=require("electron"),d=require("node:os"),s=require("node:path"),i=require("node:fs/promises");d.release().startsWith("6.1")&&e.app.disableHardwareAcceleration();process.platform==="win32"&&e.app.setAppUserModelId(e.app.getName());e.app.requestSingleInstanceLock()||(e.app.quit(),process.exit(0));let a=null;const p=s.join(__dirname,"../preload/index.js"),o=process.env.VITE_DEV_SERVER_URL,l=s.join(__dirname,"../../dist/index.html");async function u(){a=new e.BrowserWindow({title:"Kortana Studio",icon:s.join(__dirname,"../../public/favicon.ico"),width:1440,height:900,minWidth:1024,minHeight:768,frame:!0,backgroundColor:"#0f1115",show:!0,webPreferences:{preload:p,nodeIntegration:!1,contextIsolation:!0}}),e.Menu.setApplicationMenu(null),a.webContents.setWindowOpenHandler(({url:t})=>(e.shell.openExternal(t),{action:"deny"})),o?(console.log("[Main] Loading Dev Server:",o),a.loadURL(o)):(console.log("[Main] Loading File:",l),a.loadFile(l).catch(t=>console.error("[Main] Load error:",t))),a.webContents.on("did-fail-load",(t,r,n)=>{console.error(`[Main] Page failed to load: ${r} ${n}`)}),a.webContents.on("render-process-gone",(t,r)=>{console.error(`[Main] Renderer process gone: ${r.reason} (${r.exitCode})`)})}e.app.whenReady().then(u);e.app.on("window-all-closed",()=>{a=null,process.platform!=="darwin"&&e.app.quit()});e.ipcMain.handle("fs:readFile",async(t,r)=>{try{return await i.readFile(r,"utf-8")}catch(n){throw new Error(`Failed to read file: ${n.message}`)}});e.ipcMain.handle("fs:writeFile",async(t,{filePath:r,content:n})=>{try{return await i.writeFile(r,n,"utf-8"),!0}catch(c){throw new Error(`Failed to write file: ${c.message}`)}});e.ipcMain.handle("fs:getFiles",async(t,r)=>{try{return await i.readdir(r)}catch(n){throw new Error(`Failed to list directory: ${n.message}`)}});e.ipcMain.handle("fs:selectFolder",async()=>{const t=await e.dialog.showOpenDialog({properties:["openDirectory"]});return t.canceled?null:t.filePaths[0]});e.ipcMain.handle("fs:createFolder",async(t,r)=>{try{return await i.mkdir(r,{recursive:!0}),!0}catch(n){throw new Error(`Failed to create folder: ${n.message}`)}});e.ipcMain.handle("fs:deleteFile",async(t,r)=>{try{return await i.unlink(r),!0}catch(n){throw new Error(`Failed to delete file: ${n.message}`)}});e.ipcMain.handle("fs:isDirectory",async(t,r)=>{try{return(await i.stat(r)).isDirectory()}catch{return!1}});e.ipcMain.handle("compiler:compile",async(t,r)=>{var n;return{status:"success",timestamp:new Date().toISOString(),contracts:[{name:((n=r.fileName)==null?void 0:n.split(".")[0])||"Contract",abi:[{inputs:[],name:"count",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"increment",outputs:[],stateMutability:"nonpayable",type:"function"}],bytecode:"0x608060405234801561001057600080fd5b50610150806100206000396000f3fe"}],errors:[]}});
