server {
    listen 80 default_server;
    server_name _;

    # Health Check for Render and Keep-Alive
    location /health {
        proxy_pass http://localhost:9000/api/status/health;
        proxy_set_header Host $host;
    }

    # Route default RPC to the first allocated instance
    location /rpc {
        proxy_pass http://localhost:8545;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }

    # Direct access to Management API
    location /api/ {
        proxy_pass http://localhost:9000/api/;
        proxy_set_header Host $host;
    }

    # Simple Status Page instead of default Nginx page
    location / {
        add_header Content-Type text/html;
        return 200 '<html><body style="font-family:sans-serif; background:#0f172a; color:#f8fafc; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;">
            <h1 style="color:#38bdf8;">Kortana Virtual Environment</h1>
            <p>System Status: <span style="color:#4ad66d;">ONLINE</span></p>
            <div style="background:#1e293b; padding:20px; border-radius:8px; border:1px solid #334155;">
                <p>RPC Endpoint: <code>/rpc</code></p>
                <p>Health Check: <code>/health</code></p>
                <p>Management API: <code>/api/list</code></p>
            </div>
            <p style="margin-top:20px; font-size:0.8em; opacity:0.5;">Infrastructure by Antigravity</p>
        </body></html>';
    }
}
